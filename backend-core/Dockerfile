# Backend/backend-core/Dockerfile

# Python 3.11 Slim for lightweight image
FROM python:3.11.7-slim

# C í™•ì¥ ëª¨ë“ˆ ë¹Œë“œ í™˜ê²½ ë³€ìˆ˜
ENV CRYPTOGRAPHY_DONT_BUILD_RUST=1 \
    LDFLAGS="-Wl,--strip-all"

# í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
ENV PYTHONDONTWRITEBYTECODE=1 \
    PYTHONUNBUFFERED=1 \
    TZ=Asia/Seoul

# ì‹œìŠ¤í…œ ì˜ì¡´ì„± ì„¤ì¹˜
RUN apt-get update && apt-get install -y --no-install-recommends \
    curl \
    build-essential \
    libffi-dev \ 
    libssl-dev \ 
    libpq-dev \
    && rm -rf /var/lib/apt/lists/*

# ì‘ì—… ë””ë ‰í† ë¦¬ ì„¤ì •
WORKDIR /app

# ì˜ì¡´ì„± íŒŒì¼ ë³µì‚¬ ë° ì„¤ì¹˜
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# ì†ŒìŠ¤ ì½”ë“œ ë³µì‚¬ (ê°œë°œ ì‹œ docker-composeì—ì„œ volume mountë¡œ ì˜¤ë²„ë¼ì´ë”©ë¨)
# ğŸš¨ FIX: BUILD ì»¨í…ìŠ¤íŠ¸ ìœ ì§€ë¥¼ ìœ„í•´ src í´ë”ë§Œ ë³µì‚¬í•˜ëŠ” ê²ƒì´ ë” íš¨ìœ¨ì ì…ë‹ˆë‹¤.
COPY src /app/src

# ì‹¤í–‰ í¬íŠ¸
EXPOSE 8000
# CMDëŠ” docker-composeì—ì„œ uvicorn --reloadë¡œ ì˜¤ë²„ë¼ì´ë”©ë¨